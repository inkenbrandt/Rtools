{
    "contents" : "---\ntitle: \"Trend Analysis\"\nauthor: \"Paul Inkenbrandt\"\noutput: html_document\n---\n```{r}\nx <- c(\"gte\",\"coin\",\"NADA\",\"fitdistrplus\",\"rkt\",\"zoo\",\"lubridate\",\"tidyr\",\"dplyr\")\n\nlapply(x, require, character.only=T)\n```\n\n#Requirements#\n\ns.resample(\"M\", how=\"max\")\n\n#Import data#\n```{r}\nsetInternet2(TRUE)\n\nfile_url <- \"https://raw.githubusercontent.com/inkenbrandt/IPython/master/Sample_Na.csv\"\n\ndownload.file(file_url,destfile=\"Sample\",  mode=\"wb\")\ndata <- read.csv(\"Sample\")\n\n# Print date downloaded\ndateDownloaded <- date()\nprint(paste('File downloaded ',dateDownloaded))\n\n```\n\nLimit data to parameter of interest. Aggregate station data into monthly or yearly datapoints.\n\n```{r}\nconst <- \"Sodium\"\ntime1 <- 1972\ntime2 <- 1973\ncompare <- \"year\"\ngrouping <- FALSE\n\ndf <- mutate(data, month = month(as.Date(SampleDate, format = \"%m/%d/%Y\")), year = year(as.Date(SampleDate, format = \"%m/%d/%Y\")), decade = (((year-1900)-((year-1900)%%10))+1900))\n\n\npivdates <- function(const, t1, t2, compare){\n  df <- filter(df, Param==const, year>=time1, year<=time2)\n  df <- arrange(df, StationId, SampleDate)\n  if (compare==\"year\"){\n    df <- filter(df, year==time1 | year==time2)\n    df <- group_by(df, StationId, year)\n    values <- unique(summarise(df, median = median(ResultValue)))\n    values <- na.omit(spread(values, year, median, drop=TRUE))\n  } else if (compare==\"year-month\"){\n    df <- filter(df, year==time1 | year==time2)\n    df <- group_by(df, StationId, month, year) \n    values <- unique(summarise(df, median = median(ResultValue)))\n    values <- na.omit(spread(values, year, median, drop=TRUE))\n  } else if (compare ==\"decade\"){\n    df <- filter(df, decade==time1 | decade==time2)\n    df <- group_by(df, StationId, decade)\n    values <- unique(summarise(df, median = median(ResultValue)))\n    values <- na.omit(spread(values, decade, median, drop=TRUE))\n  } else if (compare == \"monthly\"){\n    df <- filter(df, month==time1 | month==time2)\n    df <- group_by(df, StationId, month)\n    values <- unique(summarise(df, median = median(ResultValue)))\n    values <- na.omit(spread(values, month, median, drop=TRUE))\n  } else{\n    values = \"none\"\n  } \n\n  return(values)\n}\n\nnew_data <- pivdates(const, t1=time1, t2=time2, compare=\"year\")\n\n\n```\n\n#Analyze Data#\nWe followed methods by the USGS from the publication: <a href=http://pubs.usgs.gov/sir/2012/5049/>_Methods for Evaluating Temporal Groundwater Quality Data and Results of Decadal-Scale Changes in Chloride, Dissolved Solids, and Nitrate Concentrations in Groundwater in the United States, 1988–2010_</a> to generate our trend detection tools\n\n##Step-Trend Analysis##\n\"Thus, samples collected on a decadal time scale are likely to reflect an actual long-term change in concentration in the aquifer rather than a short-term change in concentration resulting from some other source of variability\"\n\n###Wilcoxon-Pratt signed-rank test###\nwilcoxsign_test(zero.method = c (“Pratt”))\nwilcox.test(immer$Y1, immer$Y2, paired=TRUE) \n```{r}\nlent <- dim(new_data)[2]\nnew_data2 <- select(new_data,x = lent-1,y = lent, StationId)\n\nres <- wilcoxsign_test(x~y, new_data2, zero.method =\"Pratt\")\n\ndfg <- merge(x= new_data2, y= data, by= \"StationId\", all.x=TRUE)\n\nif (grouping==TRUE){\n  dfg <- group_by(df,group)\n}\n```\n\n\n###Fisher's Exact test###\n<a href=https://stat.ethz.ch/R-manual/R-patched/library/stats/html/fisher.test.html>function documentation</a>\nanalyze changes in the proportion of samples that exceeded a concentration threshold\n\nfisher.test(x, y = NULL, workspace = 200000, hybrid = FALSE,\n            control = list(), or = 1, alternative = \"two.sided\",\n            conf.int = TRUE, conf.level = 0.95,\n            simulate.p.value = FALSE, B = 2000)\n\n\n###Turnbull estimator for median change###\n<http://cran.r-project.org/web/packages/gte/gte.pdf>\n\n#```{r}\ntime <- 0.15\n\nFit <- gte(Surv(time=time, type=\"left\", event=2) ~ Z, data=simul, z=c(10, 20))\n\n#```\n\n##Time-Series Analysis##\n\n###Regional Kendall test###\n\n<a href=http://cran.r-project.org/web/packages/rkt/rkt.pdf>rtk package documentation</a>\n<br>\n<a href=http://acwi.gov/monitoring/conference/2006/2006_conference_materials_notes/Concurrent_SessionG/G5Trends/G5_Helsel.pdf>Regional Kendall presentation by Hesel.</a>\n\n\n```{r, echo=FALSE}\nplot(cars)\n```\n\n",
    "created" : 1430411468692.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1363852763",
    "id" : "A67F4880",
    "lastKnownWriteTime" : 1431037801,
    "path" : "C:/PROJECTS/EPA EN/Scripts/R/Trend_Detection/Trend_Analysis.Rmd",
    "project_path" : "Trend_Analysis.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}